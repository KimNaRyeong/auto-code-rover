[
    {
        "rel_file_path": "src/_pytest/doctest.py",
        "abs_file_path": "/home/kimnal0/auto-code-rover/SWE-bench/testbed/pytest-dev__pytest/setup_pytest-dev__pytest__4.6/src/_pytest/doctest.py",
        "start": 360,
        "end": 380,
        "class_name": null,
        "method_name": "_patch_unwrap_mock_aware",
        "code": "360 def _patch_unwrap_mock_aware():\n361     \"\"\"\n362     contextmanager which replaces ``inspect.unwrap`` with a version\n363     that's aware of mock objects and doesn't recurse on them\n364     \"\"\"\n365     real_unwrap = getattr(inspect, \"unwrap\", None)\n366     if real_unwrap is None:\n367         yield\n368     else:\n369 \n370         def _mock_aware_unwrap(obj, stop=None):\n371             if stop is None:\n372                 return real_unwrap(obj, stop=_is_mocked)\n373             else:\n374                 return real_unwrap(obj, stop=lambda obj: _is_mocked(obj) or stop(obj))\n375 \n376         inspect.unwrap = _mock_aware_unwrap\n377         try:\n378             yield\n379         finally:\n380             inspect.unwrap = real_unwrap\n",
        "intended_behavior": "The `_patch_unwrap_mock_aware` function is intended to patch the `inspect.unwrap` function to prevent infinite recursion on mock objects by providing a custom stop condition that recognizes mocks. The function tries to handle unwrapping in a way that does not trip on mock objects, which Python\u2019s standard `inspect.unwrap` might not handle correctly, causing unexpected behavior or errors. To resolve the issue, the intended behavior should include additional logic to gracefully handle cases where an object does not have the `__wrapped__` attribute, explicitly checking for the existence of this attribute before attempting to access or manipulate it. This addition ensures that the patch remains compatible with all objects, whether they are mocks, wrapped functions, or have other custom behaviors not originally anticipated. This would prevent the `KeyError: '__wrapped__'` observed when running under tox or pytest by ensuring the custom unwrap logic only applies to objects it was designed to handle, thus preserving the existing functionality while enhancing reliability."
    }
]